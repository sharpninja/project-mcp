@page "/search"
@attribute [Authorize]
@using ProjectMcp.WebApp.Models
@inject ISearchService SearchService

<PageTitle>Search</PageTitle>

<ScopeGuard>
    <h1>Search</h1>

    <div class="mb-3">
        <input class="form-control" @bind="_query" placeholder="Search..." />
    </div>
    <button class="btn btn-primary" @onclick="RunSearch">Search</button>

    @if (_results is null)
    {
        <p class="mt-3">Enter a query to search.</p>
    }
    else if (_results.Count == 0)
    {
        <p class="mt-3">No results.</p>
    }
    else
    {
        <ul class="list-group mt-3">
            @foreach (var result in _results)
            {
                <li class="list-group-item">
                    <strong>@result.EntityType</strong> â€” @result.Title
                </li>
            }
        </ul>
    }
</ScopeGuard>

@code {
    [CascadingParameter(Name = "ScopeState")]
    private ScopeState? ScopeState { get; set; }

    private string _query = string.Empty;
    private IReadOnlyList<ProjectMcp.WebApp.Models.SearchResult>? _results;

    private async Task RunSearch()
    {
        if (ScopeState?.Scope is null)
        {
            _results = Array.Empty<ProjectMcp.WebApp.Models.SearchResult>();
            return;
        }
        _results = await SearchService.SearchAsync(ScopeState.Scope, _query);
    }
}
